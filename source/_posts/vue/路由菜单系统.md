---
title: 路由菜单使用指南
date: 2020-10-10 16:44:37
tags:
---


*前端路由分类，写法，store存储，持久化
后端权限控制，最终显示有权限的菜单
后台配置路由菜单*


### 一. 前端路由编写

需求：新能云项目中新加个页面模块
项目位置：前端项目solway-modules  =>  src  => newEnergyCloud
路由位置：项目位置  =>  router文件夹  =>  modules文件夹

##### 开发调试时，可以这么编写，并查看页面

#### 方法一

##### 实现
从 项目位置 => store => allMenu.js 中，在对应类型中加一项新页面的配置，例如：

``` js
{ moduleScope: 'newEnergyCloud', title: '电站运行', icon: 'iconfont icon-dianzhanyunhang', routeName: 'stationRun', disabled: false }
```

然后通过超级菜单权限：打开菜单, Ctrl+shift+alt 同时，鼠标点住菜单项双击，输入密码（当前日期，格式：31-12-2020），然后再菜单中即可找到。

##### 原理
路由的主文件：项目位置 => router => index.js中，该路由数组作为全局路由对象router，其中默认不含各个页面路由。在其他地方最终形成路由后，会添加到该router中。由于众多模块共用一套菜单数据，为了方便之后使用，故将其存入状态管理store中统一管理，即store，是最终形成菜单数据源的地方。形成过程如下：
在项目入口文件main.js中，页面渲染前，dispatch一个action（asideMenu/getMenu），在该action中，从接口获取该账号权限下的菜单信息。开发环境中，通过超级菜单权限的方法，将全菜单的标志变量allMenu置为true，则将全菜单的信息作为数据，否则将接口返回的信息作为菜单数据。然后再dispatch一个action（ermission/generateRoutes），在该action中，将有权限的菜单信息组织成需要的路由格式，最后添加进router中。


#### 方法二

##### 实现
因为项目划分了不同功能类型的主菜单，所以先确定新功能属于哪个分类，或者是新的分类。假设属于运行监视类页面，就将路由定义在modules文件夹下的monitoring.js（已定义好的）；若是新的类型，可以再新建一个文件去定义路由。
编写一个路由对象：复制一个如下的结构，修改各属性值为自己定义的名称等

``` js
{
    path: '/deviceMatrix',
    name: 'deviceMatrix',
    component: () => import('@/pages/deviceMatrix'),
    meta: {
        title: '设备矩阵',
        unrestricted: process.env.NODE_ENV === 'development', //（必须写）表示开发中，本页面不受权限限制
        icon: 'iconfont icon-shebei', // 显示在菜单左侧的图标
        requiredSelect: ['PV_STATION', 'WP_STATION'], // 配置本页面是否有查看公司、电站、光伏、风电任意一种的权限
        refresh_interval: 20 * 1000, // 本页面通用的刷新接口时间间隔
        permissionInheritance: ['deviceList'], // 配置依赖的页面作为入口，该路由页面没有菜单
        pageTheme: ['darkBlue', 'light'] // 拥有的主题，可切换
    }
}
```

新建好对应的页面文件，浏览器手输入路由名，即可打开页面。

##### 原理
路由的主文件：项目位置 => router => index.js中，引入外部分类的各路由文件并作为一个整体存在在全局中，即asyncRoutes；同理，在store中最终形成路由数据，会将asyncRoutes中的路由一起组合进来；如果不是通过开启超级权限菜单模式（方法一的模式），同样受权限影响（即接口没有返回的路由不允许访问，会跳至404页面），若定义路由中在meta参数加此项配置（unrestricted: process.env.NODE_ENV === 'development'），就是说开发时unrestricted是true，则不受权限逻辑限制，直接将此路由信息加入进路由router中。


### 二. 菜单形成

因为众多项目菜单是一致的，所以提出来做公用菜单，组件目录：solway-modules => src => comm => components => AsideMenu，由于业务需求，系统需要分不同主题色，所以菜单也会伴随有多种对应主题的菜单，在该菜单入口主文件index中，判断当前主题是哪种，加载对应主题菜单。菜单编写依赖elementUI菜单组件，并且将store中取出asideMenu.menuData作为菜单数据源，循环遍历出多级菜单。

##### 菜单跳转

菜单组件渲染完，每个菜单节点上均配置了一个route属性，值是包含name属性的对象，根据name值，分多种情况跳转页面：

**1** 若该页面是新能云newEnergyCloud中路由页面，有权限的话则根据路由跳转；

**2** 若在newEnergyCloud项目路由文件中找不到对应值，则分2种情况去跳转：

+ 判断如果是与newEnergyCloud并列的其他Vue项目模块，则对应路由/iframeModule 去使用iframe加载对应页面
+ 若不是，则对应路由 /iframe，同样使用iframe加载对应页面


##### 路由守卫

跳转前，在路由守卫中，需要判断该页面是否是正确可跳转的页面：

+ 若路由是其它Vue项目模块，开发环境不可跳转，生产环境则通过window.location.href进行全路径跳转；
+ 若监听路由定义中的meta标签含有属性requiredSelect，则表示该模块所属电站、公司、光伏、风电、等一种或者多种类型叠加。此时必须保证已选择好其中一种类型，比如光伏电站，若当前全局处于光伏电站，则直接跳转；若当前没有选择过光伏和电站，则要去做切换电站处理，切换到需求的类型。


### 三. 菜单配置

前文路由的形成中，真正有权限可访问的数据是由接口获取的，这数据需要管理员在后台页面去配置。

登录系统管理员账号，菜单中 点击系统模块，新系统Vue项目均选择版本3.0，因为系统有3种不同的角色，选择一个角色，然后进行录入，即只有该角色下才有权限访问此模块路由。

##### 配置菜单

路由名称：跟前端问，开发时已经定义好的名称
前端所属模块：这个是该路由属于Vue中哪个项目模块的意思，比如新能云首页，就属于新能云这个模块，填newEnergyCloud即可。
其他填写根据标识含义填写

